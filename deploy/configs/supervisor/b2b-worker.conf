# Supervisor config for B2B specific long-running tasks
# Configure long-running batch jobs with higher memory limits and careful retry count

[program:b2b-batch-processor]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan queue:work redis --queue=b2b-batch --sleep=10 --tries=1 --timeout=3600 --memory=1024
directory=/var/www/sibali.id
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/b2b-batch-processor.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/b2b-batch-processor-error.log
stderr_logfile_maxbytes=100MB
stderr_logfile_backups=5
stopwaitsecs=3600
killasgroup=true
stopasgroup=true
environment=APP_ENV=production,QUEUE_CONNECTION=redis,REDIS_QUEUE=b2b-batch

[program:b2b-data-sync]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan queue:work redis --queue=b2b-sync --sleep=30 --tries=3 --timeout=1800 --memory=512
directory=/var/www/sibali.id
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/b2b-data-sync.log
stdout_logfile_maxbytes=75MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/b2b-data-sync-error.log
stderr_logfile_maxbytes=75MB
stderr_logfile_backups=3
stopwaitsecs=1800
killasgroup=true
stopasgroup=true
environment=APP_ENV=production,QUEUE_CONNECTION=redis,REDIS_QUEUE=b2b-sync

[program:b2b-report-generator]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan queue:work redis --queue=b2b-reports --sleep=60 --tries=2 --timeout=2400 --memory=768
directory=/var/www/sibali.id
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/b2b-report-generator.log
stdout_logfile_maxbytes=60MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/b2b-report-generator-error.log
stderr_logfile_maxbytes=60MB
stderr_logfile_backups=3
stopwaitsecs=2400
killasgroup=true
stopasgroup=true
environment=APP_ENV=production,QUEUE_CONNECTION=redis,REDIS_QUEUE=b2b-reports

[program:b2b-contract-processor]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan queue:work redis --queue=b2b-contracts --sleep=45 --tries=1 --timeout=1200 --memory=256
directory=/var/www/sibali.id
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/b2b-contract-processor.log
stdout_logfile_maxbytes=40MB
stdout_logfile_backups=2
stderr_logfile=/var/log/supervisor/b2b-contract-processor-error.log
stderr_logfile_maxbytes=40MB
stderr_logfile_backups=2
stopwaitsecs=1200
killasgroup=true
stopasgroup=true
environment=APP_ENV=production,QUEUE_CONNECTION=redis,REDIS_QUEUE=b2b-contracts

# Group for B2B tasks
[group:b2b-tasks]
programs=b2b-batch-processor,b2b-data-sync,b2b-report-generator,b2b-contract-processor
priority=600
