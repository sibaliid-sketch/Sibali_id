# Supervisor config for optimization background tasks
# Background optimization tasks like sitemap generation and cache warmers

[program:optimization-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan schedule:run
directory=/var/www/sibali.id
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/optimization-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/optimization-worker-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=3
stopwaitsecs=300
killasgroup=true
stopasgroup=true
environment=APP_ENV=production

# Sitemap generation worker
[program:sitemap-generator]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan sitemap:generate
directory=/var/www/sibali.id
autostart=false
autorestart=false
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/sitemap-generator.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=2
stderr_logfile=/var/log/supervisor/sitemap-generator-error.log
stderr_logfile_maxbytes=20MB
stderr_logfile_backups=2
stopwaitsecs=180
killasgroup=true
stopasgroup=true
environment=APP_ENV=production

# Cache warmer worker
[program:cache-warmer]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan cache:warmer
directory=/var/www/sibali.id
autostart=false
autorestart=false
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/cache-warmer.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=2
stderr_logfile=/var/log/supervisor/cache-warmer-error.log
stderr_logfile_maxbytes=20MB
stderr_logfile_backups=2
stopwaitsecs=180
killasgroup=true
stopasgroup=true
environment=APP_ENV=production

# Database optimization worker
[program:db-optimizer]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sibali.id/artisan db:optimize
directory=/var/www/sibali.id
autostart=false
autorestart=false
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/db-optimizer.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=2
stderr_logfile=/var/log/supervisor/db-optimizer-error.log
stderr_logfile_maxbytes=20MB
stderr_logfile_backups=2
stopwaitsecs=180
killasgroup=true
stopasgroup=true
environment=APP_ENV=production

# Group for optimization tasks
[group:optimization-tasks]
programs=optimization-worker,sitemap-generator,cache-warmer,db-optimizer
priority=800
